# 快速上手

环境搭建完成了，现在我们开始创建我们第一个应用吧。

## hello world

国际惯例，第一个程序当然是hello world了。

```python3
from flask import Flask
app = Flask(__name__)
@app.route('/')
def hello_world() :
	return 'Hello,World!'
```

那我们来逐行解释一下这些代码：

- 先引入了Flask类。
- 生成了一个实例，这里面第一个参数是必填参数，他代表当前模块或者包的名称。
- 通过router()装饰器来告诉Flask触发具体函数对应的URL。
- 对应URL执行的函数体。

将以上代码保存在我们的虚拟环境中，如Hello_world.py。这里注意不能使用flask.py，因为Flask本身会使用这个文件名。

当文件创建完成后，我们就可以启动我们的服务了，不过我们还需要让程序知道Flask的入口文件在哪里，所以这里我们通过设置环境变量来指定入口文件：

```shell
export FLASK_APP=hello_world.py
```
接下来开始运行我们的服务：

```shell
flask run
```
不出意外，这里会报一个警告。是告诉我们不要在生产环境上使用测试服务。

这里我们可以通过设置当前环境为开发环境来解决此问题：

```shell
export FLASK_ENV=development
```
设置为生产环境后，flask提供了如下功能：

- 激活调试器，可用于记录出错信息或追踪堆栈等。
- 激活自动重载，当你修改文件后自动重启，无需手动重启。
- 打开Flask的调试模式。

当然，如果你不需要这些额外功能，你也可以这样做：

```shell
FLASK_DEBUG=1
```

通过这个命令来单独打开调试模式的开关。

然而，调试模式下，服务是只有本机可以访问的，要想公开访问需要关闭调试模式，并且加上如下命令:

```shell
flask run --host=0.0.0.0
```

## 路由

正如上文中的代码所示，我们可以通过router()装饰器来指定页面的路由，如：

```python3
@app.route('/')
def index():
    return 'Index Page'

@app.route('/hello')
def hello():
    return 'Hello, World'
```

事实上，url中的木屑部分，我们也可以动态的变化，基于此，我们可以构建出restful api。

### 变量规则

URL中，可以通过`<>`来声明变量，如`<variable_name>`。这部分变量会传递给函数使用。我们还可以加一个转换器来转换数据类型，如`<converter:variable_name>`。我们现在看一下具体的例子：

```python3
@app.route('/user/<username>')
def show_user_profile(username):
    # show the user profile for that user
    return 'User %s' % username

@app.route('/post/<int:post_id>')
def show_post(post_id):
    # show the post with the given id, the id is an integer
    return 'Post %d' % post_id

@app.route('/path/<path:subpath>')
def show_subpath(subpath):
    # show the subpath after /path/
    return 'Subpath %s' % subpath

```

这里，转换器支持如下几种类型：

|类型|规则|
|:--:|:--:|
|string|(缺省值)接收任何不包括斜杠的文本|
|int|接收正整数|
|float|接收正浮点数|
|path|类型string，但可以包含斜杠|
|uuid|接收UUID字符串|

### URL重定向行为

在使用router的时候，我们可以有两种方式：

```python3
@app.route('/projects/')
def projects():
    return 'The project page'

@app.route('/about')
def about():
    return 'The about page'
```

很明显，两者的区别在于末尾是否包含斜杠。事实上，他们对应的行为也不相同：

- 尾部包含斜杠的，当访问地址不包含斜杠时，Flask会自动重定向，帮你在尾部添加一个斜杠，访问得以成功。
- 尾部不包含斜杠的，当访问地址包含斜杠时，则无法正确访问。


